<!DOCTYPE HTML>
<html lang="en">
<head>
<title>Source code</title>
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body>
<main role="main">
<div class="sourceContainer">
<pre><span class="sourceLineNo">001</span><a id="line.1">package me.aecsocket.calibre;</a>
<span class="sourceLineNo">002</span><a id="line.2"></a>
<span class="sourceLineNo">003</span><a id="line.3">import me.aecsocket.calibre.component.CalibreSlot;</a>
<span class="sourceLineNo">004</span><a id="line.4">import me.aecsocket.calibre.component.PaperComponent;</a>
<span class="sourceLineNo">005</span><a id="line.5">import me.aecsocket.calibre.gui.SlotViewGUI;</a>
<span class="sourceLineNo">006</span><a id="line.6">import me.aecsocket.calibre.system.BukkitItemEvents;</a>
<span class="sourceLineNo">007</span><a id="line.7">import me.aecsocket.calibre.wrapper.slot.BukkitSlot;</a>
<span class="sourceLineNo">008</span><a id="line.8">import me.aecsocket.unifiedframework.gui.GUIView;</a>
<span class="sourceLineNo">009</span><a id="line.9">import org.bukkit.entity.Player;</a>
<span class="sourceLineNo">010</span><a id="line.10">import org.bukkit.event.EventHandler;</a>
<span class="sourceLineNo">011</span><a id="line.11">import org.bukkit.event.Listener;</a>
<span class="sourceLineNo">012</span><a id="line.12">import org.bukkit.event.inventory.ClickType;</a>
<span class="sourceLineNo">013</span><a id="line.13">import org.bukkit.event.inventory.InventoryClickEvent;</a>
<span class="sourceLineNo">014</span><a id="line.14">import org.bukkit.event.player.PlayerInteractEvent;</a>
<span class="sourceLineNo">015</span><a id="line.15">import org.bukkit.inventory.EquipmentSlot;</a>
<span class="sourceLineNo">016</span><a id="line.16">import org.bukkit.inventory.ItemStack;</a>
<span class="sourceLineNo">017</span><a id="line.17"></a>
<span class="sourceLineNo">018</span><a id="line.18">public class CalibreListener implements Listener {</a>
<span class="sourceLineNo">019</span><a id="line.19">    private final CalibrePlugin plugin;</a>
<span class="sourceLineNo">020</span><a id="line.20"></a>
<span class="sourceLineNo">021</span><a id="line.21">    public CalibreListener(CalibrePlugin plugin) {</a>
<span class="sourceLineNo">022</span><a id="line.22">        this.plugin = plugin;</a>
<span class="sourceLineNo">023</span><a id="line.23">    }</a>
<span class="sourceLineNo">024</span><a id="line.24"></a>
<span class="sourceLineNo">025</span><a id="line.25">    @EventHandler</a>
<span class="sourceLineNo">026</span><a id="line.26">    public void onEvent(PlayerInteractEvent event) {</a>
<span class="sourceLineNo">027</span><a id="line.27">        if (event.getHand() != EquipmentSlot.HAND) return;</a>
<span class="sourceLineNo">028</span><a id="line.28">        for (EquipmentSlot slot : EquipmentSlot.values()) {</a>
<span class="sourceLineNo">029</span><a id="line.29">            PaperComponent component = plugin.getComponentOrNull(event.getPlayer().getInventory().getItem(slot));</a>
<span class="sourceLineNo">030</span><a id="line.30">            if (component == null)</a>
<span class="sourceLineNo">031</span><a id="line.31">                return;</a>
<span class="sourceLineNo">032</span><a id="line.32">            component.tree().call(BukkitItemEvents.BukkitInteract.of(event, component, slot));</a>
<span class="sourceLineNo">033</span><a id="line.33">        }</a>
<span class="sourceLineNo">034</span><a id="line.34">    }</a>
<span class="sourceLineNo">035</span><a id="line.35"></a>
<span class="sourceLineNo">036</span><a id="line.36">    @EventHandler</a>
<span class="sourceLineNo">037</span><a id="line.37">    public void onEvent(InventoryClickEvent event) {</a>
<span class="sourceLineNo">038</span><a id="line.38">        ItemStack clickedStack = event.getCurrentItem();</a>
<span class="sourceLineNo">039</span><a id="line.39">        ItemStack cursorStack = event.getCursor();</a>
<span class="sourceLineNo">040</span><a id="line.40">        PaperComponent clicked = plugin.getComponentOrNull(clickedStack);</a>
<span class="sourceLineNo">041</span><a id="line.41">        PaperComponent cursor = plugin.getComponentOrNull(cursorStack);</a>
<span class="sourceLineNo">042</span><a id="line.42">        ClickType type = event.getClick();</a>
<span class="sourceLineNo">043</span><a id="line.43">        Player player = (Player) event.getWhoClicked();</a>
<span class="sourceLineNo">044</span><a id="line.44"></a>
<span class="sourceLineNo">045</span><a id="line.45">        GUIView view = plugin.getGUIManager().getView(player);</a>
<span class="sourceLineNo">046</span><a id="line.46">        if (view != null &amp;&amp; view.getGUI() instanceof SlotViewGUI) {</a>
<span class="sourceLineNo">047</span><a id="line.47">            if (event.getClickedInventory() == event.getView().getTopInventory())</a>
<span class="sourceLineNo">048</span><a id="line.48">                return;</a>
<span class="sourceLineNo">049</span><a id="line.49">        }</a>
<span class="sourceLineNo">050</span><a id="line.50"></a>
<span class="sourceLineNo">051</span><a id="line.51">        if (clicked == null)</a>
<span class="sourceLineNo">052</span><a id="line.52">            return;</a>
<span class="sourceLineNo">053</span><a id="line.53">        if (clicked.tree().call(BukkitItemEvents.BukkitClick.of(event, clicked)).cancelled())</a>
<span class="sourceLineNo">054</span><a id="line.54">            return;</a>
<span class="sourceLineNo">055</span><a id="line.55"></a>
<span class="sourceLineNo">056</span><a id="line.56">        if (cursor != null &amp;&amp; type == ClickType.LEFT &amp;&amp; plugin.setting("quick_modify", "enabled").getBoolean(true)) {</a>
<span class="sourceLineNo">057</span><a id="line.57">            int clickedAmt = clickedStack.getAmount();</a>
<span class="sourceLineNo">058</span><a id="line.58">            if (clickedAmt == 1 || clickedAmt == cursorStack.getAmount()) {</a>
<span class="sourceLineNo">059</span><a id="line.59">                CalibreSlot slot = clicked.combine(cursor, plugin.setting("quick_modify", "limited").getBoolean(true));</a>
<span class="sourceLineNo">060</span><a id="line.60">                if (slot != null) {</a>
<span class="sourceLineNo">061</span><a id="line.61">                    event.setCurrentItem(clicked.create(player.getLocale(), clickedStack));</a>
<span class="sourceLineNo">062</span><a id="line.62">                    event.getView().setCursor(cursorStack.subtract(clickedAmt));</a>
<span class="sourceLineNo">063</span><a id="line.63">                    event.setCancelled(true);</a>
<span class="sourceLineNo">064</span><a id="line.64">                }</a>
<span class="sourceLineNo">065</span><a id="line.65">            }</a>
<span class="sourceLineNo">066</span><a id="line.66">            return;</a>
<span class="sourceLineNo">067</span><a id="line.67">        }</a>
<span class="sourceLineNo">068</span><a id="line.68"></a>
<span class="sourceLineNo">069</span><a id="line.69">        if (cursor == null &amp;&amp; type == ClickType.RIGHT &amp;&amp; plugin.setting("slot_view", "enabled").getBoolean(true)) {</a>
<span class="sourceLineNo">070</span><a id="line.70">            event.setCancelled(true);</a>
<span class="sourceLineNo">071</span><a id="line.71">            new SlotViewGUI(</a>
<span class="sourceLineNo">072</span><a id="line.72">                    plugin, clicked,</a>
<span class="sourceLineNo">073</span><a id="line.73">                    plugin.setting("slot_view", "modification").getBoolean(true),</a>
<span class="sourceLineNo">074</span><a id="line.74">                    plugin.setting("slot_view", "limited").getBoolean(true),</a>
<span class="sourceLineNo">075</span><a id="line.75">                    BukkitSlot.of(event::getCurrentItem, event::setCurrentItem)</a>
<span class="sourceLineNo">076</span><a id="line.76">            ).open(player);</a>
<span class="sourceLineNo">077</span><a id="line.77">        }</a>
<span class="sourceLineNo">078</span><a id="line.78">    }</a>
<span class="sourceLineNo">079</span><a id="line.79">}</a>




























































</pre>
</div>
</main>
</body>
</html>
